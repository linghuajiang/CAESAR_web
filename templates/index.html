<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <link rel="shortcut icon" href="/static/images/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/static/images/favicon.ico" type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="HiRes project">
    <meta name="author" content="item084">
    <title>Liu Lab | CAESAR</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link href="/static/css/index.css" rel="stylesheet">
    <link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://vis.nucleome.org/static/lib/nb-dispatch.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
  </head>

  <body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-md navbar-dark fixed-top" style="background-color: #353535cc;">
      <a class="navbar-brand font-weight-bold" href="/">Liu&nbsp;Lab&nbsp;&#124;&nbsp;CAESAR</a>
        <ul class="navbar-nav mr-auto">
          <li class="nav-item active">
            <a class="nav-link" href="/">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="modal" data-target="#nav-caesar" href="#">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="modal" data-target="#nav-contact" href="#">Contact</a>
          </li>
          <!--li class="nav-item">
            <a class="nav-link" href="#">Link</a>
          </li-->
          <!--li class="nav-item">
            <a class="nav-link disabled" href="#">Disabled</a>
          </li-->
        </ul>

        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link disabled" href="#">Log out</a>
          </li>
        </ul>
        <!--form class="form-inline mt-2 mt-md-0">
          <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form-->
    </nav>

    <!-- Pop-up Modals -->
    <!-- About -->
    <div class="modal fade bd-example-modal-xl" id="nav-caesar">
      <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">About CAESAR</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body text-left" style="margin-left: 20px; margin-right: 20px;">
            <p>Leveraging currently available high-resolution chromatin organizational data
              (Micro-C) on H1-ESC and HFF, CAESAR imputes high-resolution contact maps for
              90 human tissues/cell-types from low-resolution Hi-C and epigenomic features.
              CAESAR imputes all chromatin contacts with genomic distances less than 200 kb,
              which cover most fine-scale structures (e.g., loops and stripes) discovered by Micro-C.
              CAESAR web server allows users to explore these high-resolution chromatin
              contact maps at 1 kb resolution.
              For specific fine-scale chromatin structures (e.g., loops or stripes),
              CAESAR uses integrated gradient to identify the responsible epigenomic features
              during the imputation. In the web server, the user can choose arbitrary regions
              for attribution calculation and the results will be visualized below the contact map.
            </p>
          </div>
        </div>
      </div>
    </div>
    
    <div class="modal fade bd-example-modal-xl" id="nav-contact">
      <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Contact Liu Lab</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body text-left" style="margin-left: 20px; margin-right: 20px;">
            <div class="container-fluid d-flex flex-row justify-content-center">
              <div class="mr-5">
                <p>For CAESAR model's technical details, please contact Fan Feng [fanfeng@umich.edu].
                  For accessing the data and web server, please contact Yuan Yao [kelyao@umich.edu].
                  We use GitHub Issues to track technical issues [https://github.com/item084/hirespy/issues].
                  (Currently we use this link. In the final we need to switch to the repo for CAESAR model.)
                </p>
              </div>
            <div class="w-100">
              <ul class="list-group">
                <li class="list-group-item d-flex justify-content-between align-items-center">
                <a href="https://jieliu6.github.io" target="_blank" class="contact label" style="color: black;">Home</a>
                <a href="https://jieliu6.github.io" target="_blank" class="icon-home contact" style="color:black; font-size:14pt"></a></li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                <a href="mailto:drjieliu@umich.edu" target="_blank" class="contact label" style="color: black;">Email</a>
                <a href="mailto:drjieliu@umich.edu" target="_blank" class="icon-envelope-alt contact" style="color: #b23121; font-size:14pt"></a></li>
                <li class="list-group-item d-flex justify-content-between align-items-center">
                <a href="https://github.com/jieliu6" target="_blank" class="contact label" style="color: black;">GitHub</a>
                <a href="https://github.com/jieliu6" target="_blank" class="icon-github contact" style="font-size:14pt"></a></li>
              </ul>
            </div>
            </div>
          </div>
        </div>
      </div>
    </div>

  <!-- main -->
  <div class="main container-fluid d-flex flex-row justify-content-center">
    <!-- panel -->
    <div class="container panel d-flex flex-column"> 
      <div class="card panel-body mt-5 text-left">
        <!-- title -->  
        <div class="d-flex flex-column justify-content-center text-center">
          <div>
            <h1 class="h3 font-weight-normal">CAESAR</h1>
          </div>
          <!-- learn more -->
          <div class="d-flex flex-row justify-content-center">
            <a href="#" data-toggle="modal" data-target="#projectDetails" class="project title"
              style="color: gray; font-size: 14px; margin-top: 4px; border-bottom: solid 1px #e4e4e4; width: fit-content">
              About
            </a>
            <span style="color: gray; font-size: 14px; margin-top: 4px; width: fit-content">&nbsp;|&nbsp;</span>
            <a href="/post/download-tissues/" target="_blank"
              style="color: gray; font-size: 14px; margin-top: 4px; border-bottom: solid 1px #e4e4e4; width: fit-content">
              Data Download
            </a>
            <span style="color: gray; font-size: 14px; margin-top: 4px; width: fit-content">&nbsp;|&nbsp;</span>
            <a href="#" data-toggle="modal" data-target="#visitStat" class="project title"
              style="color: gray; font-size: 14px; margin-top: 4px; border-bottom: solid 1px #e4e4e4; width: fit-content">
              Visit Stat
            </a>
            <span style="color: gray; font-size: 14px; margin-top: 4px; width: fit-content">&nbsp;|&nbsp;</span>
            <a href="#" data-toggle="modal" data-target="#cite" class="project title"
              style="color: gray; font-size: 14px; margin-top: 4px; border-bottom: solid 1px #e4e4e4; width: fit-content">
              Cite
            </a>
            <span style="color: gray; font-size: 14px; margin-top: 4px; width: fit-content">&nbsp;|&nbsp;</span>
            <a href="#" data-toggle="modal" data-target="#allhelp" class="project title"
              style="color: gray; font-size: 14px; margin-top: 4px; border-bottom: solid 1px #e4e4e4; width: fit-content">
              Help
            </a>
          </div>

        </div>

        <hr />

        <!-- steps -->
        <form class='w-100' action="/" method="post" enctype="multipart/form-data">
          <!-- option -->
          <label class="text-left" data-toggle="tooltip" data-placement="left" title="Visualize in Nucleome Browser">
            <strong>Step 1:</strong> Select a biosample (<a data-toggle="modal" data-target="#availableTissues" href=""
            style="font-size: 14px; border-bottom: solid 1px #e4e4e4;">view all</a>) to visualize:

            <a data-toggle="modal" data-target="#step1help" href=""
              style="font-size: 14px; border-bottom: solid 1px #e4e4e4;">help</a>
          </label>
          <!--select class="form-control mb-3" name="type" id="type" required autofocus>
            <option value="default"></option>
            {% for dataset in datasets %}
            <option value="{{ dataset.name }}">{{ dataset.name }}</option>
            {% endfor %}
          </select-->

          <div class="input-group mb-3">
            <!--div class="input-group-prepend">
              <label class="input-group-text" for="inputGroupClassification">Classification</label>
            </div-->
            <select class="custom-select" id="inputGroupClassification">
              <option value="default" selected>Choose...</option>
              <option value="tissue">tissue</option>
              <option value="cell line">cell line</option>
              <option value="primary cell">primary cell</option>
              <option value="in vitro differentiated cells">in vitro differentiated cells</option>
            </select>
          </div>
          <div class="input-group mb-3">
            <!--div class="input-group-prepend">
              <label class="input-group-text" for="inputGroupTermName">Term name</label>
            </div-->
            <select class="custom-select" id="inputGroupTermName" disabled>
              <option value="default" selected>Choose...</option>
            </select>
          </div>
          <div class="input-group mb-3">
            <!--div class="input-group-prepend">
              <label class="input-group-text" for="inputGroupDonor">Donor</label>
            </div-->
            <select class="custom-select" id="inputGroupDonor" disabled>
              <option value="default" selected>Choose...</option>
              <option value="1">1</option>
            </select>
          </div>

          <!-- button to view contact map and eQTL -->
          <button class="btn btn-outline-primary btn-block" id="view_btn" type="button" disabled>View contact map</button>
          <!-- button to view as data -->
          <div class = "row mt-2">
            <div class="col-md-4">
                <button class="btn btn-outline-primary btn-block" id="view_eqtl_btn" type="button" disabled>View eQTL</button>
            </div>
            <div class="col-md-8">
                <button class="btn btn-outline-primary btn-block" id="view_as_btn" type="button" disabled>View allele-specific data</button>
            </div>
          </div>
          <!-- input -->
          <label class="text-left" for="submit" data-toggle="tooltip" data-placement="left" title="e.g. chr7:100431453-100449162,chr7:100482501-100490325">
          <strong >Step 2:</strong> Select a region of interest on the contact map:
          <a data-toggle="modal" data-target="#step2help" href=""
            style="font-size: 14px; border-bottom: solid 1px #e4e4e4;">help</a>
          </label>
          <div class="input-group mb-3">
            <div class="input-group-prepend">
              <span class="input-group-text">Region</span>
            </div>
            <!-- input not required autofocus -->
            <input type="text" name="region" id="region" class="form-control" autocomplete="off" placeholder="" required >
          </div>
          <!-- button onclick="submit_query()"-->
          <button class="btn btn-outline-primary btn-block" id="submit_btn" type="button" disabled>Compute attribution</button>
        </form>
    
        <hr />

        <!-- progress bar -->
        <label for="prog_out" class="text-left w-100">Progress:</label>
        <div id="prog_out" class="progress mb-3 w-100">
          <div id="prog_in" class="progress-bar bg-success" role="progressbar" style="width: 0%;">0%</div>
        </div>
        <div class="prog_line"></div>
        <button href="#" 
          target="_blank" class="btn btn-outline-primary btn-block" id="go_btn" disabled>View attribution results</button>
        <div id="go_url" style="display: none;">#</div>
        <!-- result area -->
        <div class="form-group text-left w-100" style="margin-top: 4pt;">
          <label for="resultArea" >Details:</label>
          <textarea class="form-control z-depth-1" id="resultArea" rows="3" placeholder="Details will be shown here..."></textarea>
        </div>
        <div class="d-flex justify-content-center">
          <div class="spinner-border text-success" role="status" id="spinner" style="visibility: hidden">
            <span class="sr-only">Loading...</span>
          </div>
        </div>
        <!-- div class="container p-3 mb-3 border text-left">
          Link:
        </div -->

        <!--hr />
        <div class="w-100 d-flex flex-row mb-2 align-items-start">
          <div class="w-100 d-flex flex-column align-items-start">
            <label class="text-left" data-toggle="tooltip" data-placement="left" title="step3">
              <strong >Step 3:</strong> Compare with global structures:
              <a data-toggle="modal" data-target="#step3help" href=""
              style="font-size: 14px; border-bottom: solid 1px #e4e4e4;">help</a>
            </label>
            <div>
              <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="customRadioInline1" name="customRadioInline1" class="custom-control-input">
                <label class="custom-control-label" for="customRadioInline1">loops</label>
              </div>
              <div class="custom-control custom-radio custom-control-inline">
                <input type="radio" id="customRadioInline2" name="customRadioInline1" class="custom-control-input">
                <label class="custom-control-label" for="customRadioInline2">stripes</label>
              </div>
            </div>
          </div>
        </div>
        <button href="#" 
          target="_blank" class="btn btn-outline-primary btn-block" id="subt_btn" disabled>Button</button>
        <div id="inter_url" style="display: none;">#</div-->


      </div>
    
      <!-- toast -->
      <div class="toast text-left" data-autohide="false">
        <div class="toast-header mr-auto text-primary">
          Tip:
        </div>
        <div class="toast-body">
          Please wait for the process bar to complete.<br>
            Avoid frequent resubmissions.
        </div>
      </div>
    </div>
    <!-- window -->
    <div class="window border-0 border-dark embed-responsive mt-5" id="nbframe">
      <iframe name="nbrowser" id="nbrowser" class="embed-responsive-item" allowfullscreen></iframe>
    </div>
  </div>
    
  <hr />

  <!-- copyright -->
  <p class="mt-5 text-muted"><!--&copy;-->Acknowledgment : <a href="https://vis.nucleome.org/" target="_blank"
     style="color: gray; text-decoration: none; border-bottom: solid 1px #e4e4e4;">Nucleome Browser</a></p>
  <p class="mb-3 text-muted"><!--&copy;-->&copy; Liu Lab | University of Michigan | 2020</p>
    
  <!-- tutorial -->
  <!--div class="jumbotron">
      <h1 class="display-4">Tutorial</h1>
      <p class="lead">Step 1</p>
      <hr class="my-4">
      <p>write something</p>
      <a class="btn btn-primary btn-lg" target="_blank" href="/static/tutorial/tutorial.pdf" role="button">tutorial.pdf</a>
  </div-->

  <!-- footer -->
  <footer class="blog-footer">
      <!--p>Template from <a class="navlink" href="https://getbootstrap.com/">Bootstrap</a> by <a class="navlink" href="https://twitter.com/mdo">@mdo</a>.</p>
      <p-->
      <a class="navlink" href="#">Back to top</a>
      </p>
  </footer>

  <!-- Modals -->

  <!-- Vertically centered modal -->
  <div class="modal fade bd-example-modal-xl" id="projectDetails" data-keyboard="false" tabindex="-1" >
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">CAESAR</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body text-left" style="margin-left: 20px; margin-right: 20px;">
          <p>Leveraging currently available high-resolution chromatin organizational data (Micro-C) on H1-ESC and HFF, CAESAR imputes high-resolution contact maps for 90 human tissues/cell types from low-resolution Hi-C and epigenomic features. CAESAR imputes all chromatin contacts with genomic distances less than 200 kb, which cover most fine-scale structures (e.g., loops and stripes) discovered by Micro-C.
            CAESAR web server allows users to explore these high-resolution chromatin contact maps at 1 kb resolution.
            For specific fine-scale chromatin structures (e.g., loops or stripes), CAESAR uses integrated gradient to identify the responsible epigenomic features during the imputation. In the web server, the user can choose arbitrary regions for attribution calculation and the results will be visualized below the contact map.</p>
      </div>
      </div>
    </div>
  </div>

  <div class="modal fade bd-example-modal-xl" id="cite" data-keyboard="false" tabindex="-1" >
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Cite</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body text-left" style="margin-left: 20px; margin-right: 20px;">
          <p> <strong>Connecting high-resolution 3D chromatin organization with epigenomics</strong><br>
            Fan Feng, Yuan Yao, Xue Qing David Wang, Xiaotian Zhang, Jie Liu.
            Nat Commun 13, 2054 (2022); doi: https://doi.org/10.1038/s41467-022-29695-6 </p>     </div>
      </div>
    </div>
  </div>

  <div class="modal fade bd-example-modal-xl" id="visitStat" data-keyboard="false" tabindex="-1" >
    <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Visit Statistics</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body text-left" style="margin-left: 20px; margin-right: 20px;">
          <div id='chartbtn'>
            <button type="button" class="btn btn-primary" id='showchart'>Show Chart</button>
          </div>
          <div class="row justify-content-md-center">
            <div class="w-75"><canvas id="myChart"></canvas></div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <div class="modal fade bd-example-modal-xl" id="step1help" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
      <div class="modal-content">
      <div class="modal-header">
      <h5 class="modal-title" id="exampleModalCenterTitle">Step 1: </h5>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
      </div>
      <div class="modal-body">
      <!-- Slide -->
      <div id="carouselExampleCaptions" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
          <li data-target="#carouselExampleCaptions" data-slide-to="0" class="active"></li>
          <li data-target="#carouselExampleCaptions" data-slide-to="1"></li>
        </ol>
        <div class="carousel-inner">
          <div class="carousel-item active">
          <img src="/static/images/1A.gif" class="d-block w-100" alt="...">
          <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
            <h5>Step 1.A</h5>
            <p>Select a tissue and click on the button to see its visualization in Nucleome Browser.</p>
          </div>
          </div>
          <div class="carousel-item">
          <img src="/static/images/1B.gif" class="d-block w-100" alt="...">
          <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
            <h5>Step 1.B</h5>
            <p>Drag a region in Nucleom Browser and you can see its coordination in the top-left box.</p>
          </div>
          </div>
        </div>
        <a class="carousel-control-prev" href="#carouselExampleCaptions" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleCaptions" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      <!-- div class="modal-footer">
      <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
      <button type="button" class="btn btn-primary">Save changes</button>
      </div -->
        </div>
      </div>
    </div>
    </div>
    <div class="modal fade bd-example-modal-xl" id="step2help" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
      <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Step 2: </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Slide -->
        <div id="carouselExampleCaptions1" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
          <li data-target="#carouselExampleCaptions1" data-slide-to="0" class="active"></li>
          <li data-target="#carouselExampleCaptions1" data-slide-to="1"></li>
          </ol>
          <div class="carousel-inner">
          <div class="carousel-item active">
            <img src="/static/images/2A.gif" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
            <h5>Step 2.A</h5>
            <p>Paste the region you copied from Nucleome Browser that you want to apply attribution calculation. Wait for the calculation to complete.</p>
            </div>
          </div>
          <div class="carousel-item">
            <img src="/static/images/2B.gif" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
            <h5>Step 2.B</h5>
            <p>When it finishes, click on the button to see the results as tracks.</p>
            </div>
          </div>
          </div>
          <a class="carousel-control-prev" href="#carouselExampleCaptions1" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleCaptions1" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
          </a>
        </div>
      <!-- div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div -->
      </div>
      </div>
    </div>
    </div>

    <div class="modal fade bd-example-modal-xl" id="allhelp" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered" role="document">
        <div class="modal-content">
        <div class="modal-header">
        <h5 class="modal-title" id="exampleModalCenterTitle">Help: </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
        </div>
        <div class="modal-body">
        <!-- Slide -->
        <div id="carouselExampleCaptions_all" class="carousel slide" data-ride="carousel">
          <ol class="carousel-indicators">
            <li data-target="#carouselExampleCaptions_all" data-slide-to="0" class="active"></li>
            <li data-target="#carouselExampleCaptions_all" data-slide-to="1"></li>
            <li data-target="#carouselExampleCaptions_all" data-slide-to="2"></li>
            <li data-target="#carouselExampleCaptions_all" data-slide-to="3"></li>
          </ol>
          <div class="carousel-inner">
            <div class="carousel-item active">
            <img src="/static/images/1A.gif" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
              <h5>Step 1.A</h5>
              <p>Select a tissue and click on the button to see its visualization in Nucleome Browser.</p>
            </div>
            </div>
            <div class="carousel-item">
            <img src="/static/images/1B.gif" class="d-block w-100" alt="...">
            <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
              <h5>Step 1.B</h5>
              <p>Drag a region in Nucleom Browser and you can see its coordination in the top-left box.</p>
            </div>
            </div>
            <div class="carousel-item">
              <img src="/static/images/2A.gif" class="d-block w-100" alt="...">
              <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
              <h5>Step 2.A</h5>
              <p>Paste the region you copied from Nucleome Browser that you want to apply attribution calculation. Wait for the calculation to complete.</p>
              </div>
            </div>
            <div class="carousel-item">
              <img src="/static/images/2B.gif" class="d-block w-100" alt="...">
              <div class="carousel-caption d-none d-md-block" style="color: black; background-color: #ffffffdd;">
              <h5>Step 2.B</h5>
              <p>When it finishes, click on the button to see the results as tracks.</p>
              </div>
            </div>
          </div>
          <li data-target="#carouselExampleCaptions" data-slide-to="2"></li>
          <a class="carousel-control-prev" href="#carouselExampleCaptions_all" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#carouselExampleCaptions_all" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
      </div>
    </div>
  </div>
  </div>



    <div class="modal fade bd-example-modal-xl" id="availableTissues" data-keyboard="false" tabindex="-1" >
      <div class="modal-dialog modal-dialog-centered modal-xl" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title">Biosamples</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body text-left" style="margin-left: 20px; margin-right: 20px;">
            <div class="row">
              <div class="col-4">
                <div class="list-group list-group-flush" id="list-tab" role="tablist">
                  <a class="list-group-item list-group-item-action active" id="list-tissue-list" data-toggle="list" href="#list-tissue" role="tab">tissue</a>
                  <a class="list-group-item list-group-item-action" id="list-cell-line-list" data-toggle="list" href="#list-cell-line" role="tab">cell line</a>
                  <a class="list-group-item list-group-item-action" id="list-primary-cell-list" data-toggle="list" href="#list-primary-cell" role="tab">primary cell</a>
                  <a class="list-group-item list-group-item-action" id="list-in-vitro-list" data-toggle="list" href="#list-in-vitro" role="tab" >in vitro differentiated cells</a>
                </div>
              </div>
              <div class="col-8">
                <div class="w-100 tab-content" id="nav-tabContent">
                  <div class="tab-pane fade show active" id="list-tissue" role="tabpanel">
                    <table class="table table-sm table-bordered"><thead><tr><th scope="col">Tissue</th><th scope="col">Donor</th></tr></thead><tbody><tr ><th scope="row" style="width:50%;" rowspan="1">adrenal gland</th><td>mixed*</td></tr><tr ><th scope="row" style="width:50%;" rowspan="2">ascending aorta</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="2">body of pancreas</th><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="2">breast epithelium</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="2">esophagus muscularis mucosa</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="3">esophagus squamous epithelium</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="4">gastrocnemius medialis</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">gastroesophageal sphincter</th><td>mixed</td></tr><tr ><th scope="row" style="width:50%;" rowspan="2">heart left ventricle</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">lung</th><td>mixed</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">ovary</th><td>mixed</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">pancreas</th><td>mixed</td></tr><tr ><th scope="row" style="width:50%;" rowspan="4">peyer's patch</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">prostate gland</th><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="2">right atrium auricular region</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="2">sigmoid colon</th><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="3">spleen</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="3">stomach</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">suprapubic skin</th><td>mixed</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">testis</th><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">thoracic aorta</th><td>mixed</td></tr><tr ><th scope="row" style="width:50%;" rowspan="3">thyroid gland</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">tibial artery</th><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="4">tibial nerve</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="3">transverse colon</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="4">upper lobe of left lung</th><td>GTEX-1LVAN (female, 51yrs)</td></tr><tr ><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><td>GTEX-1JKYN (male, 37yrs)</td></tr><tr ><td>GTEX-1K2DA (male, 54yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">uterus</th><td>GTEX-1LGRB (female, 53yrs)</td></tr><tr ><th scope="row" style="width:50%;" rowspan="1">vagina</th><td>GTEX-1LVAN (female, 51yrs)</td></tr></tbody></table>
                    *mixed: Contact map imputed from biosamples from different donors.
                  </div>
                  <div class="tab-pane fade" id="list-cell-line" role="tabpanel">
                    <table class="table table-sm table-bordered"><thead><tr><th scope="col">Cell line</th><th scope="col">Donor</th></tr></thead><tbody><tr ><th scope="row" style="width:50%;">A549</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">A673</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">GM12878</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">GM23338</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">HCT116</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">HeLa-S3</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">HepG2</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">K562</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">Karpas-422</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">MCF-7</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">MM1S</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">OCI-LY7</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">PC-3</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">PC-9</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">SK-N-SH</th><td>biosample donor</td></tr></tbody></table>
                  </div>
                  <div class="tab-pane fade" id="list-primary-cell" role="tabpanel">
                    <table class="table table-sm table-bordered"><thead><tr><th scope="col">Primary cell</th><th scope="col">Donor</th></tr></thead><tbody><tr ><th scope="row" style="width:50%;">B cell</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">CD14-positive monocyte</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">astrocyte</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">endothelial cell of umbilical vein</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">fibroblast of dermis</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">fibroblast of lung</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">foreskin fibroblast</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">foreskin keratinocyte</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">keratinocyte</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">mammary epithelial cell</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">osteoblast</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">skeletal muscle myoblast</th><td>biosample donor</td></tr></tbody></table>
                  </div>
                  <div class="tab-pane fade" id="list-in-vitro" role="tabpanel">
                    <table class="table table-sm table-bordered"><thead><tr><th scope="col">In vitro differentiated cells</th><th scope="col">Donor</th></tr></thead><tbody><tr ><th scope="row" style="width:50%;">bipolar neuron</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">cardiac muscle cell</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">hepatocyte</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">myotube</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">neural progenitor cell</th><td>biosample donor</td></tr><tr ><th scope="row" style="width:50%;">smooth muscle cell</th><td>biosample donor</td></tr></tbody></table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  <!-- Frame expand -->


  <!-- Go modal -->
  <div class="modal fade" tabindex="-1" role="dialog" id="go_mdl">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Finished.</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <p>Attribution computation finished.</p>
          <p>Show the result now?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="go_mdl_btn_1" data-dismiss="modal">In this tab</button>
          <button type="button" class="btn btn-primary" id="go_mdl_btn_2" data-dismiss="modal">In a new tab</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Later</button>
        </div>
      </div>
    </div>
  </div>


  <script>
      var config = {
        // The type of chart we want to create
        type: 'line',
    
        // The data for our dataset
        data: {
            labels: ['label'],
            datasets: [{
                label: 'Guests',
                backgroundColor: 'rgba(0, 0, 0, 0)',
                borderColor: 'rgb(0, 99, 132)',
                data: [0]
            },
            {
                label: 'Views',
                backgroundColor: 'rgba(0, 0, 0, 0)',//.1)',
                borderColor: 'rgb(201, 203, 207)',
                data: [0]
            },
            {
                label: 'Attrs',
                backgroundColor: 'rgba(0, 0, 0, 0)',//.1)',
                borderColor: 'rgb(132, 99, 0)',
                data: [0]
            },
            //{
            //    label: 'My Second dataset',
            //    backgroundColor: 'rgba(0, 0, 0, 0)',
            //    borderColor: 'rgb(0, 99, 132)',
            //    data: [1, 0, 1, 4, 10, 40, 35]
            //}
            ]
        },
    
        // Configuration options go here
        options: {
          responsive: true,
          title: {
            display: true,
            text: 'Daily visit stat'
          },
          tooltips: {
            mode: 'index',
            intersect: false,
          },
          hover: {
            mode: 'nearest',
            intersect: true
          },
          scales: {
            xAxes: [{
              display: true,
              scaleLabel: {
                display: true,
                labelString: 'Date'
              }
            }],
            yAxes: [{
              display: true,
              scaleLabel: {
                display: true,
                labelString: '# of visits'
              }
            }]
          },
          legend: {
            display: true,
            labels: {
              usePointStyle: true,
          }
        }
        },
      };
    
      function show_chart() {
        document.getElementById('chartbtn').innerHTML = 'Loading chart...';
        let ctx = document.getElementById('myChart').getContext('2d');
        async function get_plot_data() {
          let feedback = await fetch(`/api/v1/plot/`, {
              credentials: 'include',
              method: 'get',
            }).then((response) => {
              if (!response.ok) throw Error(response.statusText);
                return response.json();
            }).then((feedback) => {
              console.log(feedback)
              return feedback
            }).catch(
              (error) => {
                console.log(error)
              }
            );
          config['data']['labels'] = feedback['dates'];
          config['data']['datasets'][0]['data'] = feedback['guests'];
          config['data']['datasets'][1]['data'] = feedback['views'];
          config['data']['datasets'][2]['data'] = feedback['attrs'];
          //console.log(feedback[0]);
          //console.log(feedback[1]);
          //console.log(feedback[2]);
          var chart = new Chart(ctx, config);
          document.getElementById('chartbtn').innerHTML = '';
        };
        get_plot_data();
      }

      show_chart();


  </script>

  <!-- Collect guest info -->
  <script>
    async function post_stats(type) {
      let msg = {};
      let res = await fetch(`/api/v1/stats/${type}/`, {
        credentials: 'include',
        headers: {
          'Content-Type': 'application/json',
        },
        method: 'post',
        body: JSON.stringify(msg),
      }).then((response) => {
        if (!response.ok) throw Error(response.statusText);
      }).then((feedback) => {
      }).catch(
        (error) => {
          console.log(error)
        }
      );
    }

    post_stats("guest")
  </script>



  <script>

    /* Select contact map according to options */
    function select_url() {
      let opt = $('#inputGroupDonor').val();
      console.log(opt)
      if (opt!='default') {
        console.log(`https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${2900+parseInt(opt)}.json`);
        return `https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${2900+parseInt(opt)}.json`
        
      }
      return "https://vis.nucleome.org/";
    }

    function view_frame() {
      post_stats("view");
      let nbframe = document.getElementById("nbframe");
      let tissueurl = select_url();
      /*console.log(tissueurl);*/
      if (nbframe.style.width==="100%") {
        window.open(tissueurl, "nbrowser");
        document.getElementById("region").placeholder = "copy the region and paste here";
      } else {
        document.getElementById("nbframe").style.width="100%";
        setTimeout(() => {
          window.open(tissueurl, "nbrowser");
          document.getElementById("region").placeholder = "copy the region and paste here";
        }, 600);
      }
    }

    /* Select eQTLs according to options */
    function eqtl_url() {
      let opt = $('#inputGroupDonor').val();
      console.log(opt)
      if (opt!='default') {
        console.log(`https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${3300+parseInt(opt)}.json`);
        return `https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${3300+parseInt(opt)}.json`
        
      }
      return "https://vis.nucleome.org/";
    }

    function eqtl_frame() {
      post_stats("view");
      let nbframe = document.getElementById("nbframe");
      let eqtlurl = eqtl_url();
      /*console.log(tissueurl);*/
      if (nbframe.style.width==="100%") {
        window.open(eqtlurl, "nbrowser");
        document.getElementById("region").placeholder = "copy the region and paste here";
      } else {
        document.getElementById("nbframe").style.width="100%";
        setTimeout(() => {
          window.open(eqtlurl, "nbrowser");
          document.getElementById("region").placeholder = "copy the region and paste here";
        }, 600);
      }
    }

    /* Select allele specific data according to options */
    function as_url() {
      let opt = $('#inputGroupDonor').val();
      //view_as(opt);
      console.log(opt)
      if (opt!='default') {
        console.log(`https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${3100+parseInt(opt)}.json`);
        return `https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${3100+parseInt(opt)}.json`
        
      }
      return "https://vis.nucleome.org/";
    }

    function as_frame() {
      post_stats("view");
      let nbframe = document.getElementById("nbframe");
      let asurl = as_url();
      console.log(asurl)
      if (nbframe.style.width==="100%") {
        window.open(asurl, "nbrowser");
        document.getElementById("region").placeholder = "copy the region and paste here";
      } else {
        document.getElementById("nbframe").style.width="100%";
        setTimeout(() => {
          window.open(asurl, "nbrowser");
          document.getElementById("region").placeholder = "copy the region and paste here";
        }, 600);
      }
    }

    function go_frame() {
      let nbframe = document.getElementById("nbframe");
      let gourl = document.getElementById("go_url").innerText;
      console.log(gourl)
      if (nbframe.style.width==="100%") {
        window.open(gourl, "nbrowser");
        setTimeout(() => {
        //  console.log("nav and highlight")
        //  window.nav();
          window.high();
        }, 4000);
      } else {
        document.getElementById("nbframe").style.width="100%";
        setTimeout(() => {
          window.open(gourl, "nbrowser")
        }, 600);
        setTimeout(() => {
        //  console.log("nav and highlight")
        //  window.nav();
          window.high();
        }, 5000);
      }
    }

    function subt_frame() {
      let nbframe = document.getElementById("nbframe");
      let subturl = document.getElementById("inter_url").innerText;
      //subturl = 'https://nucleome.dcmb.med.umich.edu/interactive';
      console.log(subturl)
      if (nbframe.style.width==="100%") {
        document.getElementById("nbrowser").src = subturl;
        //$("#nbrowser").remove();
        $("#nbrowser").remove();
        var i = `<iframe name="nbrowser" id="nbrowser" class="embed-responsive-item" src="${subturl}" allowfullscreen></iframe>`;
        $("#nbframe").append(i);
        //window.open(subturl, "nbrowser");
        console.log(subturl)
      } else {
        document.getElementById("nbrowser").style.width="100%";
        setTimeout(() => {
          window.open(subturl, "nbrowser")
        }, 600);
      }
    }

    function go_blank() {
      let gourl = document.getElementById("go_url").innerText;
      window.open(gourl, "_blank");
    }

    document.getElementById("view_btn").onclick=view_frame;
    document.getElementById("view_eqtl_btn").onclick=eqtl_frame;
    document.getElementById("view_as_btn").onclick=as_frame;
    document.getElementById("go_btn").onclick=go_frame;
    document.getElementById("go_mdl_btn_1").onclick=go_frame;
    document.getElementById("go_mdl_btn_2").onclick=go_blank;
    //document.getElementById("subt_btn").onclick=subt_frame;
  </script>

  <!-- Select options -->
  <script>

    function reset() {
        disable_buttons();
        $("#inputGroupClassification").val("default");
        $("#inputGroupTermName").val("default");
        $("#inputGroupTermName").prop('disabled', true);
        $("#inputGroupDonor").val("default");
        $("#inputGroupDonor").prop('disabled', true);
    }
    reset();
    function disable_buttons() {
        $("#submit_btn").prop('disabled', true);
        $("#view_btn").prop('disabled', true);
        $("#view_eqtl_btn").prop('disabled', true);
        $("#view_as_btn").prop('disabled', true);
        $("#view_btn").target = "_self";
        $('#go_btn').prop('disabled', true);
        $('#subt_btn').prop('disabled', true);
    }
    function allow_buttons_step1() {
        $("#submit_btn").prop('disabled', false);
        $("#view_btn").prop('disabled', false);
        $("#view_eqtl_btn").prop('disabled', false);
        $("#view_as_btn").prop('disabled', false);
        $("#subt_btn").prop('disabled', false);
        $("#view_btn").target = "_blank"
    }
    /*
    function change_view() {
      let opt = document.getElementById('type').value;
      if (opt === "default") {
        disable_buttons();
      } else {
        allow_buttons_step1();
        }
    }
    document.getElementById("type").onchange=change_view;
    */

    async function change_inputGroupClassification() {
      let opt = $("#inputGroupClassification").val();
      console.log(opt);
      disable_buttons();
      $("#inputGroupTermName").val("default");
      $("#inputGroupTermName").prop('disabled', true);
      $("#inputGroupDonor").val("default");
      $("#inputGroupDonor").prop('disabled', true);
      if (opt === "default") {

      } else {
        await fetch(`/api/v1/options/terms/${opt}/`, {
          credentials: 'include',
          method: 'get',
        }).then((response) => {
          if (!response.ok) throw Error(response.statusText);
          return response.json();
        }).then((feedback) => {
          $("#inputGroupTermName").empty();
          $('#inputGroupTermName').append(new Option('Choose...', 'default'));
          feedback['terms'].forEach(element => {
            $('#inputGroupTermName').append(new Option(element, element));
          });
          $("#inputGroupTermName").prop('disabled', false);
        }).catch(
          (error) => {
            console.log(error)
        });
        
      }
    }
    $("#inputGroupClassification").change(change_inputGroupClassification);
  
    async function change_inputGroupTermName() {
      let opt_class = $("#inputGroupClassification").val();
      let opt = $("#inputGroupTermName").val();
      console.log(opt);
      disable_buttons();
      $("#inputGroupDonor").val("default");
      $("#inputGroupDonor").prop('disabled', true);
      if (opt === "default") {

      } else {
        await fetch(`/api/v1/options/donors/${`${opt_class}_${opt}`}/`, {
          credentials: 'include',
          method: 'get',
        }).then((response) => {
          if (!response.ok) throw Error(response.statusText);
          return response.json();
        }).then((feedback) => {
          $("#inputGroupDonor").empty();
          $('#inputGroupDonor').append(new Option('Choose...', 'default'));
          for (const [name, val] of Object.entries(feedback['donors'])) {
            $('#inputGroupDonor').append(new Option(name, val));
          }
          if (Object.keys(feedback['donors']).length == 1) {
            $("#inputGroupDonor").val(feedback['donors'][Object.keys(feedback['donors'])[0]])
            allow_buttons_step1();
          } else {
            $("#inputGroupDonor").prop('disabled', false);
          }
          
        }).catch(
          (error) => {
            console.log(error)
        });
        
      }
    }
    $("#inputGroupTermName").change(change_inputGroupTermName);

    function change_inputGroupDonor() {
      let opt = $("#inputGroupDonor").val();
      console.log(opt);
      if (opt === "default") {
        console.log(opt);
        disable_buttons();
      } else {
        allow_buttons_step1();
      }
    }
    $("#inputGroupDonor").change(change_inputGroupDonor);
  </script>

  <!-- View allele-specific data -->
  <script>
    async function view_as(id) {
      post_stats("view");
      let type = document.getElementById('inputGroupDonor').value;
      let opt = $('#inputGroupDonor').val();
      await fetch(`/as/${id}/`, {
          credentials: 'include',
          method: 'get',
        }).then((response) => {
          if (!response.ok) throw Error(response.statusText);
          return response.json();
        }).then((feedback) => {
              console.log(feedback)
              return feedback
        }).catch(
          (error) => {
            console.log(error)
          }
        );
    }
  </script>


  <!-- Attribution and Progress -->
  <script>
    function listen_progress(id, port){
    // event.preventDefault();
      let source = new EventSource(`/progress/${id}`);
      source.onmessage = function (event) {
        let json = JSON.parse(event.data);
        $("#go_btn").prop('disabled', true);
        $("#submit_btn").prop('disabled', true);
        $("#spinner").css('visibility', 'visible');
        $("#prog_in").css('width', json.prog + '%');
        $("#prog_in").text(json.prog + '%');
        $("#resultArea").text("");
        $("#resultArea").prop('placeholder', json.msg);
        if (json.prog == 100) {
          $("#spinner").css('visibility', 'hidden');
          $("#resultArea").text(json.result);
          $("#submit_btn").prop('disabled', false);
          $("#go_url").text(`https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${port}.json`);
          $("#inter_url").text(`https://vis.nucleome.org/v1/main.html?config=https://nucleome.dcmb.med.umich.edu/config/port${port}i.json`);
          $("#go_btn").prop('disabled', false);
          $("#view_btn").prop('disabled', false);
          $("#view_eqtl_btn").prop('disabled', false);
          $("#view_as_btn").prop('disabled', false);
          $('#go_mdl').modal('show')
          source.close()
        }
        if (json.prog == 99) {
          $("#spinner").css('visibility', 'hidden');
          $("#resultArea").text(json.msg);
          $("#submit_btn").prop('class', 'btn btn-outline-primary btn-block')
          $("#submit_btn").prop('disabled', false);
          $("#go_btn").prop('disabled', false);
          $("#view_btn").prop('disabled', false);
          $("#view_eqtl_btn").prop('disabled', false);
          $("#view_as_btn").prop('disabled', false);
          source.close()
        }
      }
    }
    
    async function post_get_id() {
      post_stats("attr");
      // last_nav = temp_nav; //chr1:53234631-53243927,chr1:53322882-53329361
      last_brush = temp_brush;
      let type = document.getElementById('inputGroupDonor').value;
      let region = document.getElementById('region').value;
      if (region == "") {
        alert("A region must be selected, copied and pasted.");
        return;
      }
      $("#submit_btn").prop('disabled', true);
      $("#view_btn").prop('disabled', true);
      $("#view_eqtl_btn").prop('disabled', true);
      $("#view_as_btn").prop('disabled', true);
      $("#go_btn").prop('disabled', true);

      if (last_nav == null) {
        ////////////////////////////////////////////////////////////////////////////////////////
        last_nav = {"chr":region.split(':')[0], "start":parseInt(region.split(':')[1].split('-')[0])-10000, "end":parseInt(region.split(':')[2].split('-')[1])+10000}
        //last_nav = temp_nav;
      }
      console.log(last_nav)

      let msg = {
        "type": type,
        "region": region,
        "bg": last_nav,
      };
      console.log(msg)
      let res = await fetch(`/api/v1/attribution/`, {
          credentials: 'include',
          headers: {
                      'Content-Type': 'application/json',
          },
          method: 'post',
          body: JSON.stringify(msg),
        }).then((response) => {
          if (!response.ok) throw Error(response.statusText);
            return response.json();
        }).then((feedback) => {
          console.log(feedback)
          if (feedback['port'] === '0') {
            $("#resultArea").text('Sorry, our server is busy.\nPlease try again later.');
          }
          return feedback
        }).catch(
          (error) => {
            $("#resultArea").text('Sorry, our server is busy.\nPlease try again later.');
            console.log(error)
          }
        );
      if (res['port'] != '0') {
        listen_progress(res["userid"], res["port"]);
      }
      last_brush = null
      last_nav = null
    }
    document.getElementById("submit_btn").onclick=post_get_id;

  </script>


  <!-- slide stop -->
  <script>
    $('.carousel').carousel({
      interval: false
    })
  </script>

  <!-- tooltip init-->
  <script>
    $(function () { $('[data-toggle="tooltip"]').tooltip() } )
  </script>
      
  <!-- toast init -->
  <script>
    $(document).ready(function(){
    $('.toast').toast('show');
    });
  </script>
    
  <div id="connection" style="display: none;"></div>
  <!-- Bridge -->
  <script>
    var temp_brush = null; // chr1:56732888-57068989
    var temp_nav = {"chr":"chr1", "start":56732888, "end":57068989};
    var last_brush = null;
    var last_nav = null;
    (function() {
      let chan = nb.dispatch("update","brush")
      chan.connect(function(d){
        document.getElementById("connection").innerHTML = d.connection
      })
      // document.getElementById("btn").onclick = function(e){
      //   chan.call("update",this,[{chr:"chr2",start:10000,end:50000}])                    
      // }                        
      //chan.on("update",function(d){
      //  document.getElementById("message").innerHTML = JSON.stringify(d)
      //})
      chan.on("brush",function(d){
        let temp1 = d[0]["chr"] + ":" + d[0]["start"] + "-" + d[0]["end"];
        let temp2 = d[1]["chr"] + ":" + d[1]["start"] + "-" + d[1]["end"];
        document.getElementById("region").value = temp1 + "," + temp2;
        temp_brush = d;
      })
      chan.on("update",function(d){
        temp_nav = d[0];
        last_nav = d[0];
      })
      window.nav = function(){
        if (last_nav == null) {
          return;
        }
        console.log(last_nav);
        //chan.call("update",this,[{chr:'chr1',start:1,end:2}])
        //chan.call("update",this,[last_nav])
        chan.call("update",this,[{chr:last_nav.chr,start:last_nav.start,end:last_nav.end}])
      }
      window.high = function() {
        if (last_brush == null) {
          return;
        }
        console.log(last_brush);
        chan.call("brush",this,[{
          chr:last_brush[0].chr,start:last_brush[0].start,end:last_brush[0].end,color:"grey"
        },{
          chr:last_brush[1].chr,start:last_brush[1].start,end:last_brush[1].end,color:"grey"
        }])
      }
    })()

  </script>
      
  </body>
</html>
